<!--
USER INTERFACE:
<div id=mycassette></div>
<script src="http://scissorsoft.com/cassette.js" />
<script>
var myCassette = Cassette('mycassette');
myCassette.setGearColor('FF0045');
myCassette.setBackground('http://scissorsoft.com/pix/1.jpg');
myCassette.addTrack('Working Man','Rush','http://www.boxofcassettes.com/rush/Rush-Working%20Man-320.mp3');
myCassette.addTrack('Lucky Man','The Verve','http://boxofcassettes.com/test/test-test.mp3');
myCassette.rockOut();
</script>
-->
<div id='mycassette'></div>
<script>
function addAudioPlayer() {
//<audio ontimeupdate="tick(event)" onplay="playCassette()" onpause="pauseCassette()" id="player" controls="controls" preload="auto" autobuffer>
}
function CassetteSacredGeometry() {
  //this.recordRadius = 300;
  //this.halfRecordRadius = this.recordRadius/2;
  //this.labelRadius = 40;
  //this.holeRadius = 8;
  //this.halfLabelRadius = this.labelRadius/2;

  this.gear_rpm = 15;
  this.degrees_per_minute = 15 * 360;
  this.degrees_per_second = this.degrees_per_minute / 60;
  this.angle_increase_per_interval = this.degrees_per_second *  this.draw_interval /1000;
  this.label_x_2_width_ratio = 1 / 20;
  this.label_y_2_width_ratio = 1 / 20;
  this.label_width_2_width_ratio = .85;
  this.label_height_2_height_ratio = .65;
  this.label_corner_side_2_width_ratio = .1;
  this.bottom_x_2_width_ratio = 1 / 5;
  this.bottom_width_bottom_2_width_ratio = .7;
  this.bottom_height_2_height_ratio = .25;
  this.bottom_width_top_2_bottom_width_bottom_ratio = .9;


  this.cassette_ratio = 4/2.5;
  this.cassette_width = 430;
  this.cassette_rounding_radius = 10;
  this.pixels_per_inch = this.cassette_width / 4;
  this.cassette_height = this.cassette_width / this.cassette_ratio;
  this.width_2_gear_center_x_ratio = 3.45; //4 * 8 / 9; //4 to 1 1/8
  this.width_2_gear_center_y_ratio = 3.55; //width_2_gear_center_x_ratio;
  this.width_2_gear_radius_ratio = 19;
  this.radius_2_tooth_height_ratio = 5;
  this.radius_2_rim_ratio = 10;               
  this.tooth_height_2_tooth_width_ratio = 0.8;
  this.tooth_width = 5; //FIXME - Calculate this !!! = 

//Width of the gear rim
  this.gear_width = 3; //FIXME - Calculate this !!! = 
  this.tooth_height = this.tooth_width * this.tooth_height_2_tooth_width_ratio;
  this.gear_radius = this.cassette_width / this.width_2_gear_radius_ratio;
  this.gear1_center_x = this.cassette_width / this.width_2_gear_center_x_ratio;
  this.gear2_center_x = this.cassette_width - this.gear1_center_x;              
  this.gear1_center_y = this.cassette_width / this.width_2_gear_center_y_ratio;
  this.gear2_center_y = this.gear1_center_y;
  this.window_width = (this.cassette_width * 13/16) / 4;
  this.window_height = (5/16) * this.pixels_per_inch ;
  this.small_circular_hole_radius = (this.cassette_width * ((3/16) / 4)) / 2;
  this.small_circular_hole_x1 = this.cassette_width * (1/4);
  this.small_circular_hole_y1 = (2.5 - (1/20) - (3/32) ) * this.pixels_per_inch;
  this.small_square_hole_side = (1/8) * this.pixels_per_inch;
  this.small_square_hole_x1 = (23/16) * this.pixels_per_inch;
  this.small_square_hole_y1 = this.cassette_height - ((1/8) * this.pixels_per_inch) - this.small_square_hole_side;
}
//FIXME - Make general data param
function Track(title,artist,url) {
  this.title = title;
  this.artist = artist;
  this.url = url;
}


function CassetteModel() {
  this.tracklist = [];
  this.trackIndex = -1; //-1 not started.
}

CassetteModel.prototype.addTrack = function(t) {
  this.tracklist.push(t);
};

CassetteModel.prototype.next = function() {
  var max_index = this.tracklist.length - 1;
  this.trackIndex = this.trackIndex + 1;
  if (this.trackIndex >= max_index) {
    this.trackIndex = 0;
  }
  return this.tracklist[this.trackIndex];
};
CassetteModel.prototype.previous = function() {
  this.trackIndex = this.trackIndex - 1;
  if (this.trackIndex < 0) {
    this.trackIndex = 0;
  }
  return this.tracklist[this.trackIndex];
};

CassetteView.prototype.tick = function() {
};

//QUESTION - Could the Cassette be the controller ?
//FIXME - Do we need cassette passed in anymore ?
function CassetteView(div_id,cassette) {
  this.div_id = div_id;
  this.canvas_id = div_id + "_canvas";
  alert('Set canvas_id to: ' + this.canvas_id);
  //WHY WON"T THIS WORK ????
  this.div_el = document.getElementById('mycassette');
  //this.div_el = document.getElementById(div_id);
  alert('div el ' + this.div_el);
  this.cassette = cassette;
  this.g = new CassetteSacredGeometry();
  this.gear_angle = 0;
  
  //Create the audio player
  //<audio ontimeupdate="tick(event)" onplay="playCassette()" onpause="pauseCassette()" id="player" controls="controls" preload="auto" autobuffer>
  this.audio = document.createElement('audio');
  this.audio.ontimeupdate = function() {}     ;
    //DOES NOT WORK - Maybe we need a song loaded first !
  this.audio.onplay = this.cassette.play.bind(this.cassette);
    this.audio.onplay = "alert('go');";
    this.audio.onplay = function() {alert('go2');}    ;
  this.audio.onpause = this.cassette.pause.bind(this.cassette);
  this.audio.id = div_id + "_audio";
  this.audio.controls = "controls"
  this.audio.preload = "auto";
  this.audio.autobuffer = "true";
 
  
  //Create the View Area of the Cassette
  this.ccanvas = document.createElement('canvas');
    this.ccanvas.width = 430;
    this.ccanvas.height = 269;
    this.ccanvas.id = this.canvas_id;
    alert ("Created canvas: "   + this.ccanvas);

  //FIXME CHECK NOT NULL
  
  this.div_el.appendChild(this.ccanvas);
  this.div_el.appendChild(this.audio);
  this.skin = new Image();
  this.skin.src="http://www.boxofcassettes.com:80/skin.jpg";


}

CassetteView.prototype.setBackground = function(url) {
//http://www.boxofcassettes.com//80s_hardcore/skin.jpg
  this.skin = new Image();
  this.skin.src="http://www.boxofcassettes.com//80s_hardcore/skin.jpg";
};

//FIXME - How to get around the lack of this pointer ? drawCassette is called from global
CassetteView.prototype.drawCassette = function() {
    //FIXME why is this.canvas_id undefined ?
    alert('Try to get canvas for ' + this.canvas_id);
  if (! this.ccanvas)   {
        console.log('this.ccanvas is ' + this.ccanvas)    ;
        return;
  }
  var c = this.ccanvas.getContext('2d');
  if (this.isplaying) incrementAngle();
  c.save();
  roundRect(c,0,0,this.g.cassette_width,this.g.cassette_height,this.g.cassette_rounding_radius);
  c.clip();

  //Draw cassette image
  c.beginPath();
  c.drawImage(this.skin,0,0,this.g.cassette_width,this.g.cassette_height);
  c.closePath();

  // set composite property
  
  // draw hole for gear 1 
  c.globalCompositeOperation = 'destination-out'; //compositeTypes[i];
  c.beginPath();
  //var x = cassette_width / width_2_gear_center_x_ratio;
  //var y = cassette_width / width_2_gear_center_y_ratio;
  c.arc(this.g.gear1_center_x,this.g.gear1_center_y,this.g.gear_radius,0,Math.PI*2,true);
  c.closePath();
  c.fill();

  //Hole for Gear 2
  c.beginPath();
  c.arc(this.g.gear2_center_x,this.g.gear2_center_y,this.g.gear_radius,0,Math.PI*2,true);
  c.closePath();
  c.fill();

  //Small Circular Hole 1
  c.beginPath();
  c.arc(this.g.small_circular_hole_x1,this.g.small_circular_hole_y1,this.g.small_circular_hole_radius,0,Math.PI*2,true);
  c.closePath();
  c.fill();

  //Small Circular Hole 2
  c.beginPath();
  c.arc(this.g.cassette_width - this.g.small_circular_hole_x1,this.g.small_circular_hole_y1,this.g.small_circular_hole_radius,0,Math.PI*2,true);
  c.closePath();
  c.fill();
  
 
  //Small Square Hole 1 & 2
  c.beginPath(); 
  c.fillRect(this.g.small_square_hole_x1,this.g.small_square_hole_y1,this.g.small_square_hole_side,this.g.small_square_hole_side);
  c.fillRect(this.g.cassette_width - this.g.small_square_hole_x1 - this.g.small_square_hole_side,this.g.small_square_hole_y1,this.g.small_square_hole_side,this.g.small_square_hole_side);

  //Draw window
  c.beginPath(); 
  var top_left_x = (this.g.cassette_width - this.g.window_width ) / 2; 
  var top_left_y = (14/16) * pixels_per_inch;  
  c.fillRect(this.g.top_left_x, this.g.top_left_y, this.g.window_width, this.g.window_height);
  c.restore();

  //FIXME - Add code to draw tape
  
  //Draw gears
  drawGear(c,this.g.gear1_center_x,this.g.gear1_center_y,this.g.gear_radius,this.g.angle,'c90000');
  var a2 = (this.gear_angle + 30 >= 360) ? (this.gear_angle + 30) - 360 : this.gear_angle + 30;
  drawGear(c,this.g.gear2_center_x,this.g.gear2_center_y,this.g.gear_radius,a2,'c90000');
  c.restore();
};

CassetteView.prototype.playTrack = function(t) {
  this.audio.pause();
  this.isplaying = false;
  //alert("playindex = " + config.play_index);
  var url = t.url;
  this.audio.setAttribute('src',unescape(url));
  this.audio.play();
  this.isplaying = true;
  log("PLAYING " + this.src);
};
//====================================================== Cassette (controller) ====================================
function Cassette(div_id) {
  this.isplaying = false
  this.model = new CassetteModel();
  this.view = new CassetteView(div_id,this);



}
Cassette.prototype.setBackground = function(url) {
//http://www.boxofcassettes.com//80s_hardcore/skin.jpg
  this.view.setBackground(url);

};
Cassette.prototype.play = function() {
  var t = this.model.next();
    alert('play called ' +t );
  this.view.playTrack(t);
};
Cassette.prototype.pause = function() {
  this.view.pause();
};

Cassette.prototype.addTrack = function(title,artist,url) {
  var t = new Track(title,artist,url);
  this.model.addTrack(t);
  console.log('added ' + t.title) ;
  if (!this.view.audio.src) {
      this.view.audio.src = t.url;
      this.model.trackIndex = 0;
  }
  console.log('audio src is ' + this.view.audio.src)    ;


};


Cassette.prototype.next = function() {
  var nextTrack = this.model.next();
  this.view.playTrack(nextTrack);

};
Cassette.prototype.rockOut = function() {
  //setInterval(drawVinyl, 15);
  //var c = this.view.ccanvas; //Need this for lack of this pointer
  setInterval(this.view.drawCassette.bind(this.view), draw_interval);
};

Cassette.prototype.setMessage = function(message) {
  this.message = message;
};
Cassette.prototype.sayMessage = function() {
  alert(this.message);
};

Cassette.prototype.sayHello = function() {
  alert('Hello');
};

/*
* TODO:
* - Make work in firefox
* - tape in the window
* - songlist
* - remote download and parsing
* - controlls
* - INFO section
* - skin, images, scale and position options
* - Text on cassette. 
* - 
* Todo - Online tool to export the json config
*
* mixtape = new html5MixWidget
*
* config.xml
* playlist.xml
* 

USER INTERFACE:



var myCassette = Cassette(

NOTES:
var result = httpRequest.responseText;
jsonResponse = eval('(' + result + ')');

Track:
  - url 
  - title
  - artist
  - buy_button
  - image_url
  
TrackList
  
RetroPlayer:
  - load_playlist
  - play
  - pause
  - next
  - previous
  - isPlaying


*/



/**
* Function that updates time indication
*/
function tick(e) {
 //FIXME 
 document.getElementById('progress').innerText = "Time: " + video.currentTime;
}

function playCassette() {
  if (! isplaying) {
    playStart();
    isplaying = true;
  } 
}

function pauseCassette() {
  isplaying = false;
}

function isPlaying() {
  return isplaying;
}



/**
* Draw a rounded rectangle
* @param ctxx 
*/
function roundRect (ctxx,sx,sy,ex,ey,r) {
    var r2d = Math.PI/180;
    if( ( ex - sx ) - ( 2 * r ) < 0 ) { r = ( ( ex - sx ) / 2 ); } //ensure that the radius isn't too large for x
    if( ( ey - sy ) - ( 2 * r ) < 0 ) { r = ( ( ey - sy ) / 2 ); } //ensure that the radius isn't too large for y
    ctxx.beginPath();
    ctxx.moveTo(sx+r,sy);
    ctxx.lineTo(ex-r,sy);
    ctxx.arc(ex-r,sy+r,r,r2d*270,r2d*360,false);
    ctxx.lineTo(ex,ey-r);
    ctxx.arc(ex-r,ey-r,r,r2d*0,r2d*90,false);
    ctxx.lineTo(sx+r,ey);
    ctxx.arc(sx+r,ey-r,r,r2d*90,r2d*180,false);
    ctxx.lineTo(sx,sy+r);
    ctxx.arc(sx+r,sy+r,r,r2d*180,r2d*270,false);
    ctxx.closePath();
}

function convertToRadians(degree) {
     return degree*(Math.PI/180);
}

function incrementAngle() {
  //FIXME - Don't use globals.
  angle = angle - angle_increase_per_interval;
  if(angle < 0) {
    angle = 359;
  }
}//incrementAngle

function normalizeAngle(a) {
  return (a>= 360) ? a % 360 : a;
}



/**
* Not used.  Function used for a vinyl record.
*/
function drawVinyl() {  
  ctx.clearRect(0,0,500,500) ;
  incrementAngle();
  ctx.save();                
  ctx.lineWidth = 10;  
  ctx.translate(recordRadius/2,recordRadius/2);
  ctx.rotate(convertToRadians(angle));
            
            // Create a circular clipping path        
  ctx.beginPath();
  ctx.arc(0,0,recordRadius/2,0,Math.PI*2,true);
  ctx.clip();
//------- 
//context . drawImage(image, dx, dy)
//context . drawImage(image, dx, dy, dw, dh)
//context . drawImage(image, sx, sy, sw, sh, dx, dy, dw, dh)
//------- 

  ctx.drawImage(recImg, -halfRecordRadius, -halfRecordRadius, recordRadius, recordRadius);
	//draw the record label
  ctx.restore();
  ctx.beginPath();
  var x = halfRecordRadius;
  ctx.arc(x,x, labelRadius, Math.PI*2, 0, true);
  ctx.fillStyle="#000000";                   
  ctx.fill();
  ctx.closePath();
  ctx.restore();

            //draw the hole	
  ctx.beginPath();
  ctx.fillStyle="#ffffff"; // text color
  ctx.arc(x,x, holeRadius, Math.PI*2, 0, true);
  ctx.fill();
  ctx.closePath();
  ctx.restore();
}
function getPlayer() {
  return document.getElementById('player');
}

function playStart() {
  //Janky
  config.play_index = -1;
  nextTrack();
}
/*
* Play Next Track
* Ideal inputs:
* Player and a Playlist
* Globals used:
* config
*/
function nextTrack() {
  var max_tracklist_index = config.playlist.tracklist.length - 1;
  var audio = getPlayer();
  config.play_index = config.play_index + 1;
  if (config.play_index > max_tracklist_index) {
    config.play_index = max_tracklist_index;
  }
  if (config.play_index < 0) {
    config.play_index = 0;
  }
  audio.pause();
  //alert("playindex = " + config.play_index);
  var url = config.playlist.tracklist[config.play_index].location;
  audio.setAttribute('src',unescape(url));
  audio.play();
  log(config.play_index + ":" + audio.src);
  
}
function previousTrack() {
  config.play_index = config.play_index - 2;
  if (config.play_index < -1) {
    config.play_index = -1;
  }
  nextTrack(); 
}

/**
* Globals used:
* cassette_rounding_radius
* cassette_width
* cassette_height
* gear_radius
* gear1_center_x
* gear2_center_x
* gear1_center_y
* gear2_center_y
*/
function drawCassette() {
  var c = document.getElementById('cassette').getContext('2d');
  if (isplaying) incrementAngle();
  c.save();
  roundRect(c,0,0,cassette_width,cassette_height,cassette_rounding_radius);
  c.clip();

  //Draw cassette image
  c.beginPath();
  c.drawImage(skin,0,0,cassette_width,cassette_height);
  c.closePath();

  // set composite property
  
  // draw hole for gear 1 
  c.globalCompositeOperation = 'destination-out'; //compositeTypes[i];
  c.beginPath();
  //var x = cassette_width / width_2_gear_center_x_ratio;
  //var y = cassette_width / width_2_gear_center_y_ratio;
  c.arc(gear1_center_x,gear1_center_y,gear_radius,0,Math.PI*2,true);
  c.closePath();
  c.fill();

  //Hole for Gear 2
  c.beginPath();
  c.arc(gear2_center_x,gear2_center_y,gear_radius,0,Math.PI*2,true);
  c.closePath();
  c.fill();

  //Small Circular Hole 1
  c.beginPath();
  c.arc(small_circular_hole_x1,small_circular_hole_y1,small_circular_hole_radius,0,Math.PI*2,true);
  c.closePath();
  c.fill();

  //Small Circular Hole 2
  c.beginPath();
  c.arc(cassette_width - small_circular_hole_x1,small_circular_hole_y1,small_circular_hole_radius,0,Math.PI*2,true);
  c.closePath();
  c.fill();
  
 
  //Small Square Hole 1 & 2
  c.beginPath(); 
  c.fillRect(small_square_hole_x1,small_square_hole_y1,small_square_hole_side,small_square_hole_side);
  c.fillRect(cassette_width - small_square_hole_x1 - small_square_hole_side,small_square_hole_y1,small_square_hole_side,small_square_hole_side);

  //Draw window
  c.beginPath(); 
  var top_left_x = (cassette_width - window_width ) / 2; 
  var top_left_y = (14/16) * pixels_per_inch;  
  c.fillRect(top_left_x,top_left_y,window_width,window_height);
  c.restore();

  //FIXME - Add code to draw tape
  
  //Draw gears
  drawGear(c,gear1_center_x,gear1_center_y,gear_radius,angle,'c90000');
  var a2 = (angle + 30 >= 360) ? (angle + 30) - 360 : angle + 30;
  drawGear(c,gear2_center_x,gear2_center_y,gear_radius,a2,'c90000');
  c.restore();
}



/*
* Globals Referenced: 
* radius_2_tooth_height_ratio
* radius_2_rim_ratio
* tooth_height_2_tooth_width_ratio
* tooth_width
* gear_width
* 
*/
function drawGear(ctx,cx,cy,radius,angle,color) {
  ctx.save(); //This is fun to remove
  ctx.translate(cx,cy); 
 
  var i=0; 

  //Do this for each angle
  for (i=0; i< 6; i++) {
    ctx.beginPath();
    ctx.moveTo(0,0);
    ctx.strokeStyle = color;
    ctx.lineWidth = tooth_width;
    var new_angle = angle + (60*i);
    //log ("A" + i + "=" + new_angle);
    var a = convertToRadians(normalizeAngle(new_angle));
    var x1 =  radius * Math.cos(a);
    var y1 =  radius * Math.sin(a);
    var x2 =  (radius - tooth_height - gear_width) * Math.cos(a);
    var y2 =  (radius - tooth_height - gear_width) * Math.sin(a);
    ctx.moveTo(x1,y1);
    ctx.lineTo(x2,y2);
    ctx.closePath();
    ctx.stroke();
  }
  //clear_log();  
  
  //Draw gear Rim
  ctx.beginPath();
  ctx.lineWidth = gear_width;
  //ctx.arc(cX, cY, r, startingA, endingA, antiClockwise);
  ctx.arc(0,0,radius,0,Math.PI*2,true);
  ctx.closePath();
  ctx.stroke();

  ctx.restore();
}

function clear_log() {
      document.getElementById('text').innerHTML = "";
}
function log(s) {
      var newtext = s + "\n" + document.getElementById('text').innerHTML;
      document.getElementById('text').innerHTML = newtext;
}

</script>
</head>

<body background='http://boxofcassettes.com/bg.jpg'>
<!--
<embed width="430" height="330" type="application/x-shockwave-flash" src="http://www.boxofcassettes.com:80/couch_flambeau/mixwidget.swf" wmode="transparent"></embed> 
-->
    <div id='cassette2'></div>
    <canvas width="500" height="500" id="pageCanvas">
        You do not have a canvas enabled browser
    </canvas>
    <canvas width="430" height="269" id="cassette">
    </canvas>
<!-- <audio id="playerdumb" controls="controls" preload="auto" autobuffer></audio> -->
<audio ontimeupdate="tick(event)" onplay="playCassette()" onpause="pauseCassette()" id="player" controls="controls" preload="auto" autobuffer>
Your browser does not support the audio element.
</audio>
<input type=submit onclick="nextTrack()" value="nextTrack">
<input type=submit onclick="previousTrack()" value="previousTrack">

<div id='progress'>Time is here</div>
<textarea id='text' rows=30 cols=80 >Some text here</textarea>
<script>


//------------------------- Animation Stuff --------------------------
//--------------------------------------------------------------------
var video = getPlayer();//document.getElementsByTagName('audio')[0];
var draw_interval = 30; //ms
var gear_rpm = 15;
var degrees_per_minute = 15 * 360;
var degrees_per_second = degrees_per_minute / 60;
var angle_increase_per_interval = degrees_per_second *  draw_interval /1000;
var isplaying = false;

//------------------------- Cassette Outline --------------------------
//---------------------------------------------------------------------
var label_x_2_width_ratio = 1 / 20;
var label_y_2_width_ratio = 1 / 20;
var label_width_2_width_ratio = .85;
var label_height_2_height_ratio = .65;
var label_corner_side_2_width_ratio = .1;
var bottom_x_2_width_ratio = 1 / 5;
var bottom_width_bottom_2_width_ratio = .7;
var bottom_height_2_height_ratio = .25;
var bottom_width_top_2_bottom_width_bottom_ratio = .9;


var cassette_ratio = 4/2.5;
var cassette_width = 430;
var cassette_rounding_radius = 10;
var pixels_per_inch = cassette_width / 4;
var cassette_height = cassette_width / cassette_ratio;
var width_2_gear_center_x_ratio = 3.45; //4 * 8 / 9; //4 to 1 1/8
var width_2_gear_center_y_ratio = 3.55; //width_2_gear_center_x_ratio;
var width_2_gear_radius_ratio = 19;
var radius_2_tooth_height_ratio = 5;
var radius_2_rim_ratio = 10;               
var tooth_height_2_tooth_width_ratio = 0.8;
var tooth_width = 5; //FIXME - Calculate this !!! = 

//Width of the gear rim
var gear_width = 3; //FIXME - Calculate this !!! = 
var tooth_height = tooth_width * tooth_height_2_tooth_width_ratio;
var gear_radius = cassette_width / width_2_gear_radius_ratio;
var gear1_center_x = cassette_width / width_2_gear_center_x_ratio;
var gear2_center_x = cassette_width - gear1_center_x;              
var gear1_center_y = cassette_width / width_2_gear_center_y_ratio;
var gear2_center_y = gear1_center_y;
var window_width = (cassette_width * 13/16) / 4;
var window_height = (5/16)*pixels_per_inch ;
var small_circular_hole_radius = (cassette_width * ((3/16) / 4)) / 2;
var small_circular_hole_x1 = cassette_width * (1/4);
var small_circular_hole_y1 = (2.5 - (1/20) - (3/32) ) * pixels_per_inch;
var small_square_hole_side = (1/8) * pixels_per_inch;
var small_square_hole_x1 = (23/16) * pixels_per_inch;
var small_square_hole_y1 = cassette_height - ((1/8) * pixels_per_inch) - small_square_hole_side;

var config = {
  version:1,
  play_index: -1,
  title:'Open Source Music Sampler',
  creator:'mixwidget.org',
  label:{
      url:'http://boxofcassettes.com/witch_house/image.jpg',
      rotation:0,
      x:0,
      scale:25,
      y:0,
      mask:'body'
  },
  skin:{
      url:'http://boxofcassettes.com/witch_house/skin.jpg',
      imageenabled:'true',
      shadow:0,
      gloss:30,
      outlines:20,
      framecolor:'CCCCCC',
      bodycolor:'66CCFF',
      gearboxcolor:'CCCCCC',
      gearcolor:'598B9F',
      threadercolor:'CCCCCC',
      text:{
        size:18,
        color:'FFFFFF',
        bgalpha:0,
        bgcolor:'FFFFFF',
        align:'LEFT'
      },
      tracktext:{
        x:26,
        y:21,
        width:260
      },
      artisttext:{
        x:28,
        y:38,
        width:260
      }
  },//skin
  playlist:{
    tracklist:[
      {
      location:'http://www.boxofcassettes.com/rush/Rush-Working%20Man-320.mp3',
      title:'Working Man',
      creator:'Rush',
      album:'',
      duration:''
      },
      {
      location:'http://boxofcassettes.com/test/test-test.mp3',
      title:'Lucky Man',                
      creator:'The Verve',   
      album:'',
      duration:''
      }
      ]
  }//playlist
};

/*
EXAMPLE PLAYLIST FORMAT:
<?xml version="1.0" encoding="UTF-8" ?><playlist version="1" xmlns="http://xspf.org/ns/0/">
<title>Test hits of rush</title>
<info>http://dj80hd.com</info>
<trackList>
<track><annotation>Rush-Working Man-320</annotation><location>http://www.boxofcassettes.com:80/test_hits_of_rush/Rush-Working%20Man-320.mp3</location><info>http://dj80hd.com</info><image>http://www.boxofcassettes.com:80/test_hits_of_rush.jpg</image><creator>Rush</creator><title>Working Man</title></track>
<track><annotation>Rush-Tom Sawyer-Chronicles (Disk 2)-320</annotation><location>http://www.boxofcassettes.com:80/test_hits_of_rush/Rush-Tom%20Sawyer-Chronicles%20%28Disk%202%29-320.mp3</location><info>http://dj80hd.com</info><image>http://www.boxofcassettes.com:80/test_hits_of_rush.jpg</image><creator>Rush</creator><title>Tom Sawyer</title></track>
<track><annotation>Rush-The Spirit of Radio-Permanent Waves-320</annotation><location>http://www.boxofcassettes.com:80/test_hits_of_rush/Rush-The%20Spirit%20of%20Radio-Permanent%20Waves-320.mp3</location><info>http://dj80hd.com</info><image>http://www.boxofcassettes.com:80/test_hits_of_rush.jpg</image><creator>Rush</creator><title>The Spirit of Radio</title></track>
</trackList></playlist>

*/

        //---------------
        var recordRadius = 300;
        var halfRecordRadius = recordRadius/2;
        var labelRadius = 40;
        var holeRadius = 8;
        var halfLabelRadius = labelRadius/2;
        var ctx = document.getElementById('pageCanvas').getContext('2d');
        var c = document.getElementById('cassette').getContext('2d');
        var angle = 0;
	var recImg = new Image();
        recImg.src='http://scissorsoft.com/pix/girls/girlsinfall.jpg';

        var skin = new Image();
        skin.src="http://www.boxofcassettes.com:80/skin.jpg";

        //setInterval(drawVinyl, 15);
        setInterval(drawCassette, draw_interval);


function readyStateHandler() {
 log("s="+client.state+ " status=" +client.status);
  if (client.readyState==4 && client.status==200)
    {
    //alert(client.responseText);
    }
}
config.play_index = -1;



//cass = new Cassette();
//c//ass.setMessage('hello my fiends');
//cass.sayMessage();

//var t = new Track('hey there','Jo and the Bones','http://scissorsoft.com/foo.mp3');
</script>

<script>
//document.write('<div id=mycassette></div>');
var el = document.getElementById('mycassette');
var myCassette = new Cassette('mycassette');
//myCassette.setGearColor('FF0045');
myCassette.setBackground('http://www.boxofcassettes.com/80s_hardcore/skin.jpg');
myCassette.addTrack('Working Man','Rush','http://www.boxofcassettes.com/rush/Rush-Working%20Man-320.mp3');
myCassette.addTrack('Lucky Man','The Verve','http://boxofcassettes.com/test/test-test.mp3');
myCassette.rockOut();


</script>


</body>
</html>

